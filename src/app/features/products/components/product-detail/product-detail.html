<main class="main-content">
  @if (product() != undefined) {
    <div class="container">
      <div class="product-detail-layout">
        <!-- Galerie d'images -->
        <aside class="product-gallery">
          <div class="main-image-wrapper">
            @if (product()?.isNew) {
              <span class="product-badge badge-new">Nouveau</span>
            }
            <img
              [ngSrc]="product()?.imageUrl!" fill priority
              alt="Casque audio sans fil Premium" class="main-image" id="mainImage">
          </div>
        </aside>

        <!-- Informations du produit -->
        <section class="product-info">
          <!-- En-tête du produit -->
          <div class="product-header">
            <div class="product-title-section">

              <div class="product-category-tag">
                {{ ConverterCategory.getFr(product()?.category!) }}
              </div>
              <h1 class="product-name">{{ product()?.name }}</h1>
              <p class="product-subtitle">{{ product()?.description!.substring(0, 60) }} ...</p>
            </div>
            <button class="btn-favorite"
                    (click)="onToogleFavorite()"
                    [ngClass]="isFavorite() ? 'active': ''"
                    aria-label="Ajouter aux favoris">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12 21L10.55 19.7C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 19.7L12 21Z"
                  stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>

          <!-- Avis et évaluation et stock-->
          <div class="product-rating-section">
            <div>
              <div class="rating-display">
                <div class="stars-large">
                  <span class="stars filled">★★★★★</span>
                </div>
                <span class="rating-value">{{ product()?.rating }}</span>
              </div>

            </div>
            <div style="border: 1px solid #cccccc"></div>
            <div class="stock-status" [ngClass]="product()?.inStock ? 'in-stock': 'out-of-stock'">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="1.5"/>
                <path d="M6.5 10L8.5 12L13.5 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                      stroke-linejoin="round"/>
              </svg>
              <div class="stock-info">
                <span class="stock-label">{{ product()?.inStock ? 'En stock' : 'En repture' }}</span>
                <span class="stock-quantity">{{ product()?.quantity }} unités disponibles</span>
              </div>
            </div>
          </div>

          <!-- Prix  -->
          <div class="product-pricing-section">
            <app-price-discount
            [discountPercentage]="product()?.discountPercentage"
            [price]="product()?.price!">
            </app-price-discount>
            <div class="quantity">
              <div class="item-actions">
                <div class="quantity-selector">
                  <label for="qty-1" class="quantity-label">Quantité</label>
                  <div class="quantity-controls">
                    <button class="qty-btn" (click)="decQt()" aria-label="Diminuer la quantité">−</button>
                    <input type="number" readonly class="qty-input" [value]="qtOfBuy()" aria-label="Quantité">
                    <button class="qty-btn" (click)="incQt()" aria-label="Augmenter la quantité">+</button>
                  </div>
                </div>
              </div>
              <button class="btn-add-to-cart" [disabled]="qtOfBuy()<=0" (click)="cartFacade.add(product()!, qtOfBuy())">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3 3L5 3L6.5 11L14 11L16 6L6.5 6" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="6.5" cy="14.5" r="1" fill="currentColor"/>
                  <circle cx="12.5" cy="14.5" r="1" fill="currentColor"/>
                </svg>
                Ajouter au panier
              </button>
            </div>
          </div>
        </section>
      </div>

      <div class="accordion">
        <input type="checkbox" id="section1" class="accordion-input" />
        <label for="section1" class="accordion-label">Description</label>
        <div class="accordion-content">
          <p>{{product()?.description}}</p>
        </div>
      </div>

      <div class="accordion">
        <input type="checkbox" id="section2" class="accordion-input" />
        <label for="section2" class="accordion-label">Noter ce produit</label>
          <div class="accordion-content">
            <form [formGroup]="ratingForm">
              <h4>Avis<span style="color: red">*</span></h4>
            <div class="ratingControl">
              <input id="score100" class="ratingControl__radio" type="radio" formControlName="rate" value="5" />
              <label for="score100" class="ratingControl__star" title="Cinq étoiles"></label>
              <input id="score90" class="ratingControl__radio" type="radio" formControlName="rate" value="4.5" />
              <label for="score90" class="ratingControl__star" title="Quatre étoiles et demie"></label>
              <input id="score80" class="ratingControl__radio" type="radio" formControlName="rate" value="4" />
              <label for="score80" class="ratingControl__star" title="Quatre étoiles"></label>
              <input id="score70" class="ratingControl__radio" type="radio" formControlName="rate" value="3.5" />
              <label for="score70" class="ratingControl__star" title="Trois étoiles et demie"></label>
              <input id="score60" class="ratingControl__radio" type="radio" formControlName="rate" value="3" />
              <label for="score60" class="ratingControl__star" title="Trois étoiles"></label>
              <input id="score50" class="ratingControl__radio" type="radio" formControlName="rate" value="2.5" />
              <label for="score50" class="ratingControl__star" title="Deux étoiles et demie"></label>
              <input id="score40" class="ratingControl__radio" type="radio" formControlName="rate" value="2" />
              <label for="score40" class="ratingControl__star" title="Deux étoiles"></label>
              <input id="score30" class="ratingControl__radio" type="radio" formControlName="rate" value="1.5" />
              <label for="score30" class="ratingControl__star" title="Une étoile et demie"></label>
              <input id="score20" class="ratingControl__radio" type="radio" formControlName="rate" value="1" />
              <label for="score20" class="ratingControl__star" title="Une étoile"></label>
              <input id="score10" class="ratingControl__radio" type="radio" formControlName="rate" value="0.5" />
              <label for="score10" class="ratingControl__star" title="Demi-étoile"></label>
            </div>
            <div>
              <h4>Commentaire</h4>
              <div>
                <textarea formControlName="comment"></textarea>
                <button class="btn-submit" type="submit" [disabled]="ratingForm.invalid" (click)="sendRate()">Envoyer</button>
              </div>
            </div>
            </form>

          </div>

      </div>

    </div>
  }

</main>
